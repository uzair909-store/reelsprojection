<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reels Projection</title>
  <style>
    body {
      margin: 0;
      background: #236622;
      color: white;
      font-family: 'Segoe UI', sans-serif;
      overflow: hidden;
    }

    header {
      position: fixed;
      top: 0;
      width: 100%;
      background: #1b4d1c;
      padding: 10px;
      text-align: center;
      font-size: 1.1em;
      z-index: 10;
      box-shadow: 0 2px 10px #0005;
    }

    .video-wrapper {
      width: 100vw;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      padding-top: 40px;
    }

    video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .overlay {
      position: absolute;
      bottom: 20px;
      left: 20px;
      color: white;
      font-size: 1.1em;
      background: rgba(0, 0, 0, 0.5);
      padding: 5px 10px;
      border-radius: 5px;
    }

    .center-controls {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      display: flex;
      gap: 15px;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .center-controls.show {
      opacity: 1;
    }

    .custom-btn {
      background: rgba(0, 0, 0, 0.6);
      color: white;
      border: none;
      padding: 12px 18px;
      font-size: 1em;
      border-radius: 10px;
      cursor: pointer;
      backdrop-filter: blur(5px);
    }

    #history {
      background: #143d14;
      padding: 10px;
      font-size: 0.9em;
    }

    #history h3 {
      margin: 0;
      font-size: 1.1em;
      border-bottom: 1px solid #fff3;
    }

    .history-item {
      margin-top: 10px;
      background: #1f5a1d;
      padding: 5px;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <header>
    Total Earned: <span id="earnings">$0.000</span> |
    Time Left: <span id="timeLeft">0s</span>
  </header>

  <div class="video-wrapper" id="videoWrapper"></div>

  <div class="center-controls" id="controlButtons">
    <button id="playPauseBtn" class="custom-btn">Pause</button>
    <button id="muteBtn" class="custom-btn">Unmute</button>
  </div>

  <div id="history">
    <h3>Watch History</h3>
    <div id="history-list"></div>
  </div>

  <script>
    const videoWrapper = document.getElementById("videoWrapper");
    const historyList = document.getElementById("history-list");
    const earningsText = document.getElementById("earnings");
    const timeLeftText = document.getElementById("timeLeft");
    const playPauseBtn = document.getElementById("playPauseBtn");
    const muteBtn = document.getElementById("muteBtn");
    const controlButtons = document.getElementById("controlButtons");

    let watched = new Set(JSON.parse(localStorage.getItem("watched_ids") || "[]"));
let earning = 0;
let currentIndex = 0;
let reelsData = [];
let currentVideo;
let timeInterval;
let hideTimeout;

    function loadEarningFromStorage() {
      const saved = localStorage.getItem("reels_earning");
      if (saved) {
        earning = parseFloat(saved);
        earningsText.textContent = "$" + earning.toFixed(3);
      }
    }

    function saveEarningToStorage() {
      localStorage.setItem("reels_earning", earning.toFixed(3));
    }

    function updateTimeLeft(duration, video) {
      clearInterval(timeInterval);
      timeInterval = setInterval(() => {
        if (video.ended) {
          clearInterval(timeInterval);
          timeLeftText.textContent = "0s";
        } else {
          const remaining = Math.ceil(duration - video.currentTime);
          timeLeftText.textContent = remaining + "s";
        }
      }, 1000);
    }

    function toggleControls() {
      controlButtons.classList.add("show");
      clearTimeout(hideTimeout);
      hideTimeout = setTimeout(() => {
        controlButtons.classList.remove("show");
      }, 2500);
    }

    function loadReel(index) {
  // Skip watched reels
  while (index < reelsData.length && watched.has(reelsData[index].id)) {
    index++;
  }

  if (index >= reelsData.length) {
    videoWrapper.innerHTML = "<h2 style='text-align:center;'>ðŸŽ‰ All reels watched!</h2>";
    timeLeftText.textContent = "0s";
    return;
  }

  currentIndex = index;
  const reel = reelsData[currentIndex];
  videoWrapper.innerHTML = "";

  const video = document.createElement("video");
  video.src = reel.video;
  video.setAttribute("playsinline", true);
  video.setAttribute("muted", true);
  video.setAttribute("autoplay", true);
  video.removeAttribute("controls");

  currentVideo = video;

  const overlay = document.createElement("div");
  overlay.className = "overlay";
  overlay.innerText = `Reel ID: ${reel.id}`;

  video.addEventListener("loadedmetadata", () => {
    video.play();
    updateTimeLeft(video.duration, video);
    playPauseBtn.innerText = "Pause";
    muteBtn.innerText = "Unmute";
  });

  video.addEventListener("error", () => {
    console.warn("Broken video skipped:", reel.video);
    loadReel(currentIndex + 1);
  });

  video.addEventListener("ended", () => {
    clearInterval(timeInterval);
    if (!watched.has(reel.id)) {
      watched.add(reel.id);
      saveWatchedToStorage();

      earning += 0.002;
      earningsText.textContent = "$" + earning.toFixed(3);
      saveEarningToStorage();

      const item = document.createElement("div");
      item.className = "history-item";
      item.textContent = `âœ” Reel ${reel.id} Watched`;
      historyList.appendChild(item);
    }
    loadReel(currentIndex + 1);
  });

  video.addEventListener("click", () => toggleControls());

  videoWrapper.appendChild(video);
  videoWrapper.appendChild(overlay);
}

    playPauseBtn.addEventListener("click", () => {
      if (!currentVideo) return;
      if (currentVideo.paused) {
        currentVideo.play();
        playPauseBtn.innerText = "Pause";
      } else {
        currentVideo.pause();
        playPauseBtn.innerText = "Play";
      }
    });

    muteBtn.addEventListener("click", () => {
      if (!currentVideo) return;
      currentVideo.muted = !currentVideo.muted;
      muteBtn.innerText = currentVideo.muted ? "Unmute" : "Mute";
    });

    async function loadJSON() {
  try {
    const res = await fetch("https://raw.githubusercontent.com/uzair909-store/reelsprojection/refs/heads/main/reels.json");
    reelsData = await res.json();
    loadReel(currentIndex);
  } catch (error) {
    console.error("JSON Load Error:", error);
    alert("Reels JSON file load nahi hui!");
  }
}

    loadEarningFromStorage();
    loadJSON();
  
function saveWatchedToStorage() {
  localStorage.setItem("watched_ids", JSON.stringify([...watched]));
} 
  </script>
</body>
</html>
